<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador CICS 3270 - Multi-Telas</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Painel de Controle -->
    <div class="control-panel">
        <div class="control-header">
            <div class="control-title">üñ•Ô∏è CICS Multi-Screen Terminal Simulator</div>
            <button class="add-screen-btn" onclick="openFileModal()">
                Carregar Telas TXT
            </button>
        </div>

        <div class="screen-manager">
            <!-- Lista de Telas -->
            <div class="screen-list">
                <div class="screen-list-header">
                    <span class="screen-list-title">üìÅ Telas Carregadas</span>
                    <span id="screenCount" style="color: var(--success-color); font-size: 13px; font-weight: 600;">0 telas</span>
                </div>
                <div class="screens-container" id="screensContainer">
                    <!-- Telas ser√£o listadas aqui -->
                </div>
            </div>

            <!-- Navega√ß√£o entre Telas -->
            <div class="navigation-panel">
                <div class="nav-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>üîÑ Mapeamento de Navega√ß√£o</span>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span id="rulesCount" style="color: var(--success-color); font-size: 13px; font-weight: 600;">0 regras</span>
                        <button class="export-btn" onclick="openImportModal()" title="Importar regras">üì• Importar</button>
                        <button class="export-btn" onclick="openExportModal()" title="Exportar regras">üì§ Exportar</button>
                    </div>
                </div>
                <div class="nav-mapping" id="navMapping">
                    <!-- Regras de navega√ß√£o aqui -->
                </div>
                <button class="add-nav-btn" onclick="addNavigationRule()">
                    Adicionar Regra de Navega√ß√£o
                </button>
            </div>
        </div>
    </div>

    <!-- Terminal Principal -->
    <div class="terminal-frame">
        <div class="terminal-header">
            <div class="terminal-title">CICS TERMINAL - SESSION A01</div>
            <div class="screen-indicator">
                <span class="current-screen-name" id="currentScreenName">NENHUMA TELA</span>
            </div>
            <div class="connection-status">
                <span style="font-size: 12px;">CONNECTED</span>
                <div class="status-indicator"></div>
            </div>
        </div>

        <div class="terminal-screen" id="terminal">
            <div class="cursor" id="cursor"></div>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <span id="cursorPos">01/01</span>
                <span id="fieldInfo">READY</span>
            </div>
            <div class="status-item">
                <span class="screen-counter">
                    Tela <span id="currentScreenIndex">0</span> de <span id="totalScreens">0</span>
                </span>
            </div>
            <div class="status-item">
                <span id="time"></span>
            </div>
        </div>

        <div class="function-keys">
            <div class="function-key" data-key="PF1">PF1<br>HELP</div>
            <div class="function-key" data-key="PF2">PF2<br>SPLIT</div>
            <div class="function-key" data-key="PF3">PF3<br>EXIT</div>
            <div class="function-key" data-key="PF4">PF4<br>RETURN</div>
            <div class="function-key" data-key="PF5">PF5<br>RFIND</div>
            <div class="function-key" data-key="PF6">PF6<br>RCHANGE</div>
            <div class="function-key nav-key" data-key="PF7">PF7<br>‚¨Ü PREV</div>
            <div class="function-key nav-key" data-key="PF8">PF8<br>‚¨á NEXT</div>
            <div class="function-key" data-key="PF9">PF9<br>SWAP</div>
            <div class="function-key" data-key="PF10">PF10<br>LEFT</div>
            <div class="function-key" data-key="PF11">PF11<br>RIGHT</div>
            <div class="function-key" data-key="PF12">PF12<br>CANCEL</div>
            <div class="function-key" data-key="ENTER">ENTER<br>SUBMIT</div>
        </div>
    </div>

    <!-- Modal de Carregamento de Arquivos -->
    <div class="modal-overlay" id="fileModalOverlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">üìÇ Carregar Arquivos de Tela</div>
                <button class="modal-close" onclick="closeFileModal()">‚úï</button>
            </div>
            
            <div class="modal-body">
                <div class="file-drop-zone" id="dropZone" onclick="selectFiles()">
                    <div class="file-drop-icon">üìÅ</div>
                    <div>Clique para selecionar ou arraste arquivos TXT aqui</div>
                    <div style="font-size: 12px; margin-top: 10px; opacity: 0.7;">
                        Voc√™ pode selecionar m√∫ltiplos arquivos
                    </div>
                </div>
                
                <div class="file-list" id="fileList">
                    <!-- Lista de arquivos ser√° mostrada aqui -->
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn" onclick="closeFileModal()">Cancelar</button>
                <button class="modal-btn primary" onclick="loadSelectedFiles()">Carregar Telas</button>
            </div>
        </div>
    </div>

    <!-- Mensagens de Status -->
    <div class="status-message" id="statusMessage"></div>
    
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="loader-text">PROCESSING...</div>
    </div>

    <!-- Bot√£o de Altern√¢ncia de Tema -->
    <button class="theme-toggle-btn" onclick="toggleTheme()" title="Alternar Tema">üåì</button>

    <!-- Bot√£o de Ajuda -->
    <button class="help-btn" onclick="showHelp()">?</button>

    <!-- Painel de Valida√ß√£o de Campos (Opcional) -->
    <div class="validation-panel collapsed" id="validationPanel">
        <div class="validation-header" onclick="toggleValidationPanel()">
            <span class="validation-title">Configura√ß√£o de Valida√ß√£o de Campos (Opcional)</span>
            <div style="display: flex; gap: 10px; align-items: center;">
                <button class="btn" onclick="event.stopPropagation(); openValidationExportModal()" 
                        style="padding: 5px 10px; font-size: 11px;">üì§ Exportar</button>
                <button class="toggle-btn" id="toggleValidationBtn">Expandir</button>
            </div>
        </div>
        
        <div class="validation-content">
            <div class="validation-global-config">
                <div class="validation-keys-header">
                    <h3 class="validation-keys-title">üîë Teclas que Validam Campos</h3>
                    <span class="validation-keys-subtitle">Marque as teclas que devem validar os campos antes de executar</span>
                </div>
                <div class="validation-keys-grid">
                    <label class="validation-key-item">
                        <input type="checkbox" value="ENTER" onchange="updateValidationKeys()" checked>
                        <span class="key-name">ENTER</span>
                    </label>
                    <label class="validation-key-item">
                        <input type="checkbox" value="PF1" onchange="updateValidationKeys()">
                        <span class="key-name">PF1</span>
                    </label>
                    <label class="validation-key-item">
                        <input type="checkbox" value="PF2" onchange="updateValidationKeys()">
                        <span class="key-name">PF2</span>
                    </label>
                    <label class="validation-key-item">
                        <input type="checkbox" value="PF3" onchange="updateValidationKeys()">
                        <span class="key-name">PF3</span>
                    </label>
                    <label class="validation-key-item">
                        <input type="checkbox" value="PF4" onchange="updateValidationKeys()">
                        <span class="key-name">PF4</span>
                    </label>
                    <label class="validation-key-item">
                        <input type="checkbox" value="PF5" onchange="updateValidationKeys()">
                        <span class="key-name">PF5</span>
                    </label>
                    <label class="validation-key-item">
                        <input type="checkbox" value="PF6" onchange="updateValidationKeys()">
                        <span class="key-name">PF6</span>
                    </label>
                    <label class="validation-key-item">
                        <input type="checkbox" value="PF7" onchange="updateValidationKeys()">
                        <span class="key-name">PF7</span>
                    </label>
                    <label class="validation-key-item">
                        <input type="checkbox" value="PF8" onchange="updateValidationKeys()">
                        <span class="key-name">PF8</span>
                    </label>
                    <label class="validation-key-item">
                        <input type="checkbox" value="PF9" onchange="updateValidationKeys()">
                        <span class="key-name">PF9</span>
                    </label>
                    <label class="validation-key-item">
                        <input type="checkbox" value="PF10" onchange="updateValidationKeys()">
                        <span class="key-name">PF10</span>
                    </label>
                    <label class="validation-key-item">
                        <input type="checkbox" value="PF11" onchange="updateValidationKeys()">
                        <span class="key-name">PF11</span>
                    </label>
                    <label class="validation-key-item">
                        <input type="checkbox" value="PF12" onchange="updateValidationKeys()">
                        <span class="key-name">PF12</span>
                    </label>
                </div>
            </div>
            
            <div class="validation-fields-section">
                <div class="fields-list">
                    <div class="fields-list-header">
                        <h3 class="fields-list-title">üìã Campos da Tela Atual</h3>
                    </div>
                    <div id="fieldsListContainer" class="fields-container">
                        <div class="no-data-message">Nenhuma tela carregada</div>
                    </div>
                </div>
                
                <div class="validation-config" id="validationConfig">
                    <div class="validation-config-header">
                        <h3 class="validation-config-title">‚öôÔ∏è Configurar Valida√ß√µes</h3>
                    </div>
                    <div id="fieldConfigContent" class="field-config-content">
                        <div class="no-data-message">Selecione um campo √† esquerda</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Exporta√ß√£o -->
    <div class="modal-overlay" id="exportModalOverlay">
        <div class="modal export-modal">
            <div class="modal-header">
                <h2 class="modal-title">üì§ Exportar Regras de Navega√ß√£o</h2>
                <button class="close-btn modal-close" onclick="closeExportModal()">‚úï</button>
            </div>
            
            <div class="modal-body">
                <p class="modal-description">
                    Escolha o formato de exporta√ß√£o para usar as regras no seu programa CICS:
                </p>
                
                <div class="export-options">
                    <button class="export-option-btn" onclick="exportAsJSON()">
                        <div class="export-icon">üìÑ</div>
                        <div class="export-title">JSON</div>
                        <div class="export-desc">Formato estruturado, f√°cil de importar</div>
                    </button>
                    
                    <button class="export-option-btn" onclick="exportAsCobol()">
                        <div class="export-icon">üìù</div>
                        <div class="export-title">COBOL</div>
                        <div class="export-desc">C√≥digo COBOL com EVALUATE statements</div>
                    </button>
                    
                    <button class="export-option-btn" onclick="exportAsTable()">
                        <div class="export-icon">üìä</div>
                        <div class="export-title">Tabela SQL</div>
                        <div class="export-desc">INSERT statements para banco de dados</div>
                    </button>
                    
                    <button class="export-option-btn" onclick="exportAsExcel()">
                        <div class="export-icon">üìó</div>
                        <div class="export-title">Excel (XLSX)</div>
                        <div class="export-desc">Planilha formatada com f√≥rmulas</div>
                    </button>
                    
                    <button class="export-option-btn" onclick="exportAsCSV()">
                        <div class="export-icon">üìã</div>
                        <div class="export-title">CSV</div>
                        <div class="export-desc">Compat√≠vel com qualquer planilha</div>
                    </button>
                    
                    <button class="export-option-btn" onclick="exportAsXML()">
                        <div class="export-icon">üóÇÔ∏è</div>
                        <div class="export-title">XML</div>
                        <div class="export-desc">Formato XML para integra√ß√£o</div>
                    </button>
                    
                    <button class="export-option-btn" onclick="exportAsDocumentation()">
                        <div class="export-icon">üìñ</div>
                        <div class="export-title">Documenta√ß√£o</div>
                        <div class="export-desc">HTML formatado para leitura</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Importa√ß√£o -->
    <div class="modal-overlay" id="importModalOverlay">
        <div class="modal export-modal">
            <div class="modal-header">
                <h2 class="modal-title">üì• Importar Regras de Navega√ß√£o</h2>
                <button class="close-btn modal-close" onclick="closeImportModal()">‚úï</button>
            </div>
            
            <div class="modal-body">
                <p class="modal-description">
                    Carregue um arquivo com regras de navega√ß√£o. O sistema tentar√° associar automaticamente √†s telas carregadas.
                </p>
                
                <div class="import-info">
                    <strong class="info-title">‚ÑπÔ∏è Informa√ß√µes importantes:</strong>
                    <ul class="info-list">
                        <li>Carregue suas telas ANTES de importar as regras</li>
                        <li>O sistema tentar√° encontrar telas pelo nome</li>
                        <li>Se uma tela n√£o for encontrada, voc√™ poder√° associ√°-la manualmente</li>
                        <li>Formatos aceitos: JSON, CSV, Excel (.xls)</li>
                    </ul>
                </div>

                <div class="import-drop-zone" id="importDropZone" onclick="selectImportFile()">
                    <div class="file-drop-icon">üìÅ</div>
                    <div>Clique para selecionar arquivo ou arraste aqui</div>
                    <div style="font-size: 12px; margin-top: 10px; opacity: 0.7;">
                        JSON, CSV ou Excel (.xls)
                    </div>
                </div>

                <div id="importPreview" style="display: none; margin-top: 20px;">
                    <h3 class="preview-title">üìã Pr√©-visualiza√ß√£o</h3>
                    <div id="importPreviewContent" class="import-preview-content">
                        <!-- Preview das regras aqui -->
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
                        <button class="modal-btn" onclick="closeImportModal()">Cancelar</button>
                        <button class="modal-btn primary" onclick="confirmImport()">‚úÖ Importar Regras</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Exporta√ß√£o de Valida√ß√µes -->
    <div class="modal-overlay" id="validationExportModalOverlay">
        <div class="modal export-modal">
            <div class="modal-header">
                <h2 class="modal-title">üì§ Exportar Configura√ß√µes de Valida√ß√£o</h2>
                <button class="close-btn modal-close" onclick="closeValidationExportModal()">‚úï</button>
            </div>
            
            <div class="modal-body">
                <p class="modal-description">
                    Escolha o formato de exporta√ß√£o para as valida√ß√µes e vari√°veis BMS:
                </p>
                
                <div class="export-options">
                    <button class="export-option-btn" onclick="exportValidationsAsJSON()">
                        <div class="export-icon">üìÑ</div>
                        <div class="export-title">JSON</div>
                        <div class="export-desc">Todas as configura√ß√µes em formato JSON</div>
                    </button>
                    
                    <button class="export-option-btn" onclick="exportValidationsAsCobol()">
                        <div class="export-icon">üíª</div>
                        <div class="export-title">COBOL</div>
                        <div class="export-desc">Programa com l√≥gica de valida√ß√£o</div>
                    </button>
                    
                    <button class="export-option-btn" onclick="exportValidationsAsExcel()">
                        <div class="export-icon">üìó</div>
                        <div class="export-title">Excel (XLSX)</div>
                        <div class="export-desc">Planilha com campos e valida√ß√µes</div>
                    </button>
                    
                    <button class="export-option-btn" onclick="exportValidationsAsCSV()">
                        <div class="export-icon">üìã</div>
                        <div class="export-title">CSV</div>
                        <div class="export-desc">Lista de campos e valida√ß√µes</div>
                    </button>
                    
                    <button class="export-option-btn" onclick="openBMSExportOptions()">
                        <div class="export-icon">üìù</div>
                        <div class="export-title">BMS</div>
                        <div class="export-desc">Defini√ß√£o de campos para BMS</div>
                    </button>
                    
                    <button class="export-option-btn" onclick="exportValidationsAsCopybook()">
                        <div class="export-icon">üìÑ</div>
                        <div class="export-title">Copybook</div>
                        <div class="export-desc">Copybook COBOL com campos BMS</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Op√ß√µes BMS -->
    <div class="modal-overlay" id="bmsOptionsModalOverlay">
        <div class="modal export-modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">üìù Op√ß√µes de Exporta√ß√£o BMS</h2>
                <button class="close-btn modal-close" onclick="closeBMSOptionsModal()">‚úï</button>
            </div>
            
            <div class="modal-body">
                <p class="modal-description" style="margin-bottom: 25px;">
                    Como deseja exportar os textos fixos (labels) da tela?
                </p>
                
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <button class="export-option-btn" onclick="exportValidationsAsBMS(true)" style="text-align: left;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div class="export-icon">‚úÖ</div>
                            <div>
                                <div class="export-title">COM Vari√°veis</div>
                                <div class="export-desc">Cria DFHMDF para cada label (LBL0, LBL1, etc.)</div>
                            </div>
                        </div>
                    </button>
                    
                    <button class="export-option-btn" onclick="exportValidationsAsBMS(false)" style="text-align: left;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div class="export-icon">üí¨</div>
                            <div>
                                <div class="export-title">SEM Vari√°veis</div>
                                <div class="export-desc">Labels apenas como coment√°rios no arquivo</div>
                            </div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Associa√ß√£o Manual -->
    <div class="modal-overlay" id="mappingModalOverlay">
        <div class="modal export-modal">
            <div class="modal-header">
                <h2 class="modal-title">üîó Associar Telas √†s Regras</h2>
                <button class="close-btn modal-close" onclick="closeMappingModal()">‚úï</button>
            </div>
            
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: var(--text-medium);">
                    Algumas regras n√£o puderam ser associadas automaticamente. Selecione manualmente as telas correspondentes:
                </p>
                
                <div id="mappingList" style="max-height: 400px; overflow-y: auto;">
                    <!-- Lista de associa√ß√µes aqui -->
                </div>

                <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="modal-btn" onclick="closeMappingModal()">Cancelar</button>
                    <button class="modal-btn primary" onclick="saveMappings()">üíæ Salvar Associa√ß√µes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Input de arquivo oculto -->
    <input type="file" id="fileInput" style="display: none;" accept=".txt" multiple>
    <input type="file" id="importFileInput" style="display: none;" accept=".json,.csv,.xls,.xlsx">

    <script src="js/app.js"></script>
</body>
</html>
